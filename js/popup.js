(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.pv_popup = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.12.3
(function() {
  var log_p;

  log_p = function(text) {
    return console.log(module.exports.prefix + text);
  };

  module.exports = {
    prefix: 'parse_v-crx: ',
    d: function(text) {
      return log_p('DEBUG: ' + text);
    },
    c: function(text) {
      return log_p('content script: ' + text);
    }
  };

}).call(this);



},{}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.12.3
(function() {
  var msg_type_check_support, msg_type_flush_done, msg_type_found, msg_type_get_all, msg_type_get_info, msg_type_get_one_file, msg_type_get_state, msg_type_playing, msg_type_set_time, msg_type_start_flush, msg_version, parse_v_mark, send_msg, send_to_content, set_on_msg;

  parse_v_mark = 'uuid=ec9680e6-da5e-4971-ac5f-25d971bf6366';

  msg_version = '0.1.0-1';

  msg_type_found = 'content_found';

  msg_type_playing = 'content_playing';

  msg_type_get_info = 'content_get_info';

  msg_type_check_support = 'content_check_support';

  msg_type_set_time = 'content_set_time';

  msg_type_get_state = 'popup_get_state';

  msg_type_start_flush = 'popup_start_flush';

  msg_type_flush_done = 'popup_flush_done';

  msg_type_get_all = 'dl_get_all';

  msg_type_get_one_file = 'dl_get_one_file';

  set_on_msg = function(callback) {
    return chrome.runtime.onMessage.addListener(function(msg, sender, send_res) {
      var e;
      try {
        if (!((msg.mark === parse_v_mark) && (msg.version === msg_version))) {
          return;
        }
      } catch (error) {
        e = error;
        return;
      }
      callback({
        mark: msg.mark,
        version: msg.version,
        type: msg.type,
        data: msg.data,
        sender: sender,
        callback: send_res
      });
      return true;
    });
  };

  send_msg = function(msg_type, data, callback) {
    var msg;
    msg = {
      mark: parse_v_mark,
      version: msg_version,
      type: msg_type,
      data: data
    };
    return chrome.runtime.sendMessage(null, msg, callback);
  };

  send_to_content = function(msg_type, data, callback, tab_id) {
    var msg;
    msg = {
      mark: parse_v_mark,
      version: msg_version,
      type: msg_type,
      data: data
    };
    return chrome.tabs.sendMessage(tab_id, msg, callback);
  };

  module.exports = {
    mark: parse_v_mark,
    version: msg_version,
    t: {
      found: msg_type_found,
      playing: msg_type_playing,
      get_info: msg_type_get_info,
      check_support: msg_type_check_support,
      set_time: msg_type_set_time,
      get_state: msg_type_get_state,
      start_flush: msg_type_start_flush,
      flush_done: msg_type_flush_done,
      get_all: msg_type_get_all,
      get_one_file: msg_type_get_one_file
    },
    on: set_on_msg,
    send: send_msg,
    send_to_content: send_to_content
  };

}).call(this);



},{}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.12.3
(function() {
  var draw_ui, get_current_state, get_current_tab_id, log, msg, popup_init, start_flush;

  log = require('./log');

  msg = require('./msg');

  get_current_tab_id = function() {
    return chrome.tabs.query({
      active: true,
      currentWindow: true
    }, function(result) {
      var tab_id;
      tab_id = result[0].id;
      return get_current_state(tab_id);
    });
  };

  get_current_state = function(tab_id) {
    log.d("current tab_id == " + tab_id + " ");
    return msg.send(msg.t.get_state, {
      tab_id: tab_id
    }, function(result) {
      return draw_ui(result, tab_id);
    });
  };

  draw_ui = function(info, tab_id) {
    var b, div, p;
    log.d("current state == " + (JSON.stringify(info)) + " ");
    $('#main_init_place_holder').remove();
    div = $('#popup_main_ui');
    b = $('<button type="button" >重新检测</button>');
    div.append(b);
    b.on('click', function() {
      msg.send_to_content(msg.t.check_support, null, null, tab_id);
      return log.d('popup: send check_support msg to content.js ');
    });
    if (info === null) {
      return div.append($('<p>错误: 不支持此页面 :-( </p>'));
    }
    div.append($('<h2>当前页面</h2>'));
    p = $('<p></p>');
    p.text("site: " + info.site);
    div.append(p);
    p = $('<p></p>');
    p.text("标题: " + info.title);
    div.append(p);
    p = $('<p></p>');
    p.text("URL: " + info.url);
    div.append(p);
    if (!info.playing) {
      div.append($('<hr />'));
      return div.append($('<p>请等待视频开始正常播放 .. . </p>'));
    } else {
      div.append($('<h2>视频信息</h2>'));
      p = $('<p></p>');
      p.text("视频标题: " + info.title_video + "_" + info.title_sub);
      div.append(p);
      p = $('<p></p>');
      p.text("清晰度: " + info.size);
      div.append(p);
      p = $('<p></p>');
      p.text("总时长: " + info.max_time_s + " 秒");
      div.append(p);
      b = $('<button type="button" >开始</button>');
      div.append(b);
      return b.on('click', function() {
        return start_flush(tab_id, div);
      });
    }
  };

  start_flush = function(tab_id, div) {
    msg.on(function(info) {
      var b;
      switch (info.type) {
        case msg.t.flush_done:
          div.append($('<hr /><p>获取分段文件, 结束. </p>'));
          b = $('<button type="button" >更多</button>');
          div.append(b);
          return b.on('click', function() {
            log.d('open (more) window ');
            return window.open('dl.html', '_blank');
          });
      }
    });
    return msg.send(msg.t.start_flush, {
      tab_id: tab_id
    });
  };

  popup_init = function() {
    log.d('popup.js: start init ');
    return get_current_tab_id();
  };

  popup_init();

}).call(this);



},{"./log":1,"./msg":2}]},{},[3])(3)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJkaXN0L3MvbG9nLmpzIiwiZGlzdC9zL21zZy5qcyIsImRpc3Qvcy9wb3B1cC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuMTIuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgbG9nX3A7XG5cbiAgbG9nX3AgPSBmdW5jdGlvbih0ZXh0KSB7XG4gICAgcmV0dXJuIGNvbnNvbGUubG9nKG1vZHVsZS5leHBvcnRzLnByZWZpeCArIHRleHQpO1xuICB9O1xuXG4gIG1vZHVsZS5leHBvcnRzID0ge1xuICAgIHByZWZpeDogJ3BhcnNlX3YtY3J4OiAnLFxuICAgIGQ6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHJldHVybiBsb2dfcCgnREVCVUc6ICcgKyB0ZXh0KTtcbiAgICB9LFxuICAgIGM6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHJldHVybiBsb2dfcCgnY29udGVudCBzY3JpcHQ6ICcgKyB0ZXh0KTtcbiAgICB9XG4gIH07XG5cbn0pLmNhbGwodGhpcyk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvZy5qcy5tYXBcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS4xMi4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBtc2dfdHlwZV9jaGVja19zdXBwb3J0LCBtc2dfdHlwZV9mbHVzaF9kb25lLCBtc2dfdHlwZV9mb3VuZCwgbXNnX3R5cGVfZ2V0X2FsbCwgbXNnX3R5cGVfZ2V0X2luZm8sIG1zZ190eXBlX2dldF9vbmVfZmlsZSwgbXNnX3R5cGVfZ2V0X3N0YXRlLCBtc2dfdHlwZV9wbGF5aW5nLCBtc2dfdHlwZV9zZXRfdGltZSwgbXNnX3R5cGVfc3RhcnRfZmx1c2gsIG1zZ192ZXJzaW9uLCBwYXJzZV92X21hcmssIHNlbmRfbXNnLCBzZW5kX3RvX2NvbnRlbnQsIHNldF9vbl9tc2c7XG5cbiAgcGFyc2Vfdl9tYXJrID0gJ3V1aWQ9ZWM5NjgwZTYtZGE1ZS00OTcxLWFjNWYtMjVkOTcxYmY2MzY2JztcblxuICBtc2dfdmVyc2lvbiA9ICcwLjEuMC0xJztcblxuICBtc2dfdHlwZV9mb3VuZCA9ICdjb250ZW50X2ZvdW5kJztcblxuICBtc2dfdHlwZV9wbGF5aW5nID0gJ2NvbnRlbnRfcGxheWluZyc7XG5cbiAgbXNnX3R5cGVfZ2V0X2luZm8gPSAnY29udGVudF9nZXRfaW5mbyc7XG5cbiAgbXNnX3R5cGVfY2hlY2tfc3VwcG9ydCA9ICdjb250ZW50X2NoZWNrX3N1cHBvcnQnO1xuXG4gIG1zZ190eXBlX3NldF90aW1lID0gJ2NvbnRlbnRfc2V0X3RpbWUnO1xuXG4gIG1zZ190eXBlX2dldF9zdGF0ZSA9ICdwb3B1cF9nZXRfc3RhdGUnO1xuXG4gIG1zZ190eXBlX3N0YXJ0X2ZsdXNoID0gJ3BvcHVwX3N0YXJ0X2ZsdXNoJztcblxuICBtc2dfdHlwZV9mbHVzaF9kb25lID0gJ3BvcHVwX2ZsdXNoX2RvbmUnO1xuXG4gIG1zZ190eXBlX2dldF9hbGwgPSAnZGxfZ2V0X2FsbCc7XG5cbiAgbXNnX3R5cGVfZ2V0X29uZV9maWxlID0gJ2RsX2dldF9vbmVfZmlsZSc7XG5cbiAgc2V0X29uX21zZyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbihtc2csIHNlbmRlciwgc2VuZF9yZXMpIHtcbiAgICAgIHZhciBlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCEoKG1zZy5tYXJrID09PSBwYXJzZV92X21hcmspICYmIChtc2cudmVyc2lvbiA9PT0gbXNnX3ZlcnNpb24pKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZSA9IGVycm9yO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYWxsYmFjayh7XG4gICAgICAgIG1hcms6IG1zZy5tYXJrLFxuICAgICAgICB2ZXJzaW9uOiBtc2cudmVyc2lvbixcbiAgICAgICAgdHlwZTogbXNnLnR5cGUsXG4gICAgICAgIGRhdGE6IG1zZy5kYXRhLFxuICAgICAgICBzZW5kZXI6IHNlbmRlcixcbiAgICAgICAgY2FsbGJhY2s6IHNlbmRfcmVzXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICB9O1xuXG4gIHNlbmRfbXNnID0gZnVuY3Rpb24obXNnX3R5cGUsIGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgdmFyIG1zZztcbiAgICBtc2cgPSB7XG4gICAgICBtYXJrOiBwYXJzZV92X21hcmssXG4gICAgICB2ZXJzaW9uOiBtc2dfdmVyc2lvbixcbiAgICAgIHR5cGU6IG1zZ190eXBlLFxuICAgICAgZGF0YTogZGF0YVxuICAgIH07XG4gICAgcmV0dXJuIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKG51bGwsIG1zZywgY2FsbGJhY2spO1xuICB9O1xuXG4gIHNlbmRfdG9fY29udGVudCA9IGZ1bmN0aW9uKG1zZ190eXBlLCBkYXRhLCBjYWxsYmFjaywgdGFiX2lkKSB7XG4gICAgdmFyIG1zZztcbiAgICBtc2cgPSB7XG4gICAgICBtYXJrOiBwYXJzZV92X21hcmssXG4gICAgICB2ZXJzaW9uOiBtc2dfdmVyc2lvbixcbiAgICAgIHR5cGU6IG1zZ190eXBlLFxuICAgICAgZGF0YTogZGF0YVxuICAgIH07XG4gICAgcmV0dXJuIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYl9pZCwgbXNnLCBjYWxsYmFjayk7XG4gIH07XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgbWFyazogcGFyc2Vfdl9tYXJrLFxuICAgIHZlcnNpb246IG1zZ192ZXJzaW9uLFxuICAgIHQ6IHtcbiAgICAgIGZvdW5kOiBtc2dfdHlwZV9mb3VuZCxcbiAgICAgIHBsYXlpbmc6IG1zZ190eXBlX3BsYXlpbmcsXG4gICAgICBnZXRfaW5mbzogbXNnX3R5cGVfZ2V0X2luZm8sXG4gICAgICBjaGVja19zdXBwb3J0OiBtc2dfdHlwZV9jaGVja19zdXBwb3J0LFxuICAgICAgc2V0X3RpbWU6IG1zZ190eXBlX3NldF90aW1lLFxuICAgICAgZ2V0X3N0YXRlOiBtc2dfdHlwZV9nZXRfc3RhdGUsXG4gICAgICBzdGFydF9mbHVzaDogbXNnX3R5cGVfc3RhcnRfZmx1c2gsXG4gICAgICBmbHVzaF9kb25lOiBtc2dfdHlwZV9mbHVzaF9kb25lLFxuICAgICAgZ2V0X2FsbDogbXNnX3R5cGVfZ2V0X2FsbCxcbiAgICAgIGdldF9vbmVfZmlsZTogbXNnX3R5cGVfZ2V0X29uZV9maWxlXG4gICAgfSxcbiAgICBvbjogc2V0X29uX21zZyxcbiAgICBzZW5kOiBzZW5kX21zZyxcbiAgICBzZW5kX3RvX2NvbnRlbnQ6IHNlbmRfdG9fY29udGVudFxuICB9O1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1tc2cuanMubWFwXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuMTIuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgZHJhd191aSwgZ2V0X2N1cnJlbnRfc3RhdGUsIGdldF9jdXJyZW50X3RhYl9pZCwgbG9nLCBtc2csIHBvcHVwX2luaXQsIHN0YXJ0X2ZsdXNoO1xuXG4gIGxvZyA9IHJlcXVpcmUoJy4vbG9nJyk7XG5cbiAgbXNnID0gcmVxdWlyZSgnLi9tc2cnKTtcblxuICBnZXRfY3VycmVudF90YWJfaWQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gY2hyb21lLnRhYnMucXVlcnkoe1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgY3VycmVudFdpbmRvdzogdHJ1ZVxuICAgIH0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgdmFyIHRhYl9pZDtcbiAgICAgIHRhYl9pZCA9IHJlc3VsdFswXS5pZDtcbiAgICAgIHJldHVybiBnZXRfY3VycmVudF9zdGF0ZSh0YWJfaWQpO1xuICAgIH0pO1xuICB9O1xuXG4gIGdldF9jdXJyZW50X3N0YXRlID0gZnVuY3Rpb24odGFiX2lkKSB7XG4gICAgbG9nLmQoXCJjdXJyZW50IHRhYl9pZCA9PSBcIiArIHRhYl9pZCArIFwiIFwiKTtcbiAgICByZXR1cm4gbXNnLnNlbmQobXNnLnQuZ2V0X3N0YXRlLCB7XG4gICAgICB0YWJfaWQ6IHRhYl9pZFxuICAgIH0sIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgcmV0dXJuIGRyYXdfdWkocmVzdWx0LCB0YWJfaWQpO1xuICAgIH0pO1xuICB9O1xuXG4gIGRyYXdfdWkgPSBmdW5jdGlvbihpbmZvLCB0YWJfaWQpIHtcbiAgICB2YXIgYiwgZGl2LCBwO1xuICAgIGxvZy5kKFwiY3VycmVudCBzdGF0ZSA9PSBcIiArIChKU09OLnN0cmluZ2lmeShpbmZvKSkgKyBcIiBcIik7XG4gICAgJCgnI21haW5faW5pdF9wbGFjZV9ob2xkZXInKS5yZW1vdmUoKTtcbiAgICBkaXYgPSAkKCcjcG9wdXBfbWFpbl91aScpO1xuICAgIGIgPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiA+6YeN5paw5qOA5rWLPC9idXR0b24+Jyk7XG4gICAgZGl2LmFwcGVuZChiKTtcbiAgICBiLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgbXNnLnNlbmRfdG9fY29udGVudChtc2cudC5jaGVja19zdXBwb3J0LCBudWxsLCBudWxsLCB0YWJfaWQpO1xuICAgICAgcmV0dXJuIGxvZy5kKCdwb3B1cDogc2VuZCBjaGVja19zdXBwb3J0IG1zZyB0byBjb250ZW50LmpzICcpO1xuICAgIH0pO1xuICAgIGlmIChpbmZvID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZGl2LmFwcGVuZCgkKCc8cD7plJnor686IOS4jeaUr+aMgeatpOmhtemdoiA6LSggPC9wPicpKTtcbiAgICB9XG4gICAgZGl2LmFwcGVuZCgkKCc8aDI+5b2T5YmN6aG16Z2iPC9oMj4nKSk7XG4gICAgcCA9ICQoJzxwPjwvcD4nKTtcbiAgICBwLnRleHQoXCJzaXRlOiBcIiArIGluZm8uc2l0ZSk7XG4gICAgZGl2LmFwcGVuZChwKTtcbiAgICBwID0gJCgnPHA+PC9wPicpO1xuICAgIHAudGV4dChcIuagh+mimDogXCIgKyBpbmZvLnRpdGxlKTtcbiAgICBkaXYuYXBwZW5kKHApO1xuICAgIHAgPSAkKCc8cD48L3A+Jyk7XG4gICAgcC50ZXh0KFwiVVJMOiBcIiArIGluZm8udXJsKTtcbiAgICBkaXYuYXBwZW5kKHApO1xuICAgIGlmICghaW5mby5wbGF5aW5nKSB7XG4gICAgICBkaXYuYXBwZW5kKCQoJzxociAvPicpKTtcbiAgICAgIHJldHVybiBkaXYuYXBwZW5kKCQoJzxwPuivt+etieW+heinhumikeW8gOWni+ato+W4uOaSreaUviAuLiAuIDwvcD4nKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpdi5hcHBlbmQoJCgnPGgyPuinhumikeS/oeaBrzwvaDI+JykpO1xuICAgICAgcCA9ICQoJzxwPjwvcD4nKTtcbiAgICAgIHAudGV4dChcIuinhumikeagh+mimDogXCIgKyBpbmZvLnRpdGxlX3ZpZGVvICsgXCJfXCIgKyBpbmZvLnRpdGxlX3N1Yik7XG4gICAgICBkaXYuYXBwZW5kKHApO1xuICAgICAgcCA9ICQoJzxwPjwvcD4nKTtcbiAgICAgIHAudGV4dChcIua4heaZsOW6pjogXCIgKyBpbmZvLnNpemUpO1xuICAgICAgZGl2LmFwcGVuZChwKTtcbiAgICAgIHAgPSAkKCc8cD48L3A+Jyk7XG4gICAgICBwLnRleHQoXCLmgLvml7bplb86IFwiICsgaW5mby5tYXhfdGltZV9zICsgXCIg56eSXCIpO1xuICAgICAgZGl2LmFwcGVuZChwKTtcbiAgICAgIGIgPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiA+5byA5aeLPC9idXR0b24+Jyk7XG4gICAgICBkaXYuYXBwZW5kKGIpO1xuICAgICAgcmV0dXJuIGIub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzdGFydF9mbHVzaCh0YWJfaWQsIGRpdik7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgc3RhcnRfZmx1c2ggPSBmdW5jdGlvbih0YWJfaWQsIGRpdikge1xuICAgIG1zZy5vbihmdW5jdGlvbihpbmZvKSB7XG4gICAgICB2YXIgYjtcbiAgICAgIHN3aXRjaCAoaW5mby50eXBlKSB7XG4gICAgICAgIGNhc2UgbXNnLnQuZmx1c2hfZG9uZTpcbiAgICAgICAgICBkaXYuYXBwZW5kKCQoJzxociAvPjxwPuiOt+WPluWIhuauteaWh+S7tiwg57uT5p2fLiA8L3A+JykpO1xuICAgICAgICAgIGIgPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiA+5pu05aSaPC9idXR0b24+Jyk7XG4gICAgICAgICAgZGl2LmFwcGVuZChiKTtcbiAgICAgICAgICByZXR1cm4gYi5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxvZy5kKCdvcGVuIChtb3JlKSB3aW5kb3cgJyk7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93Lm9wZW4oJ2RsLmh0bWwnLCAnX2JsYW5rJyk7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG1zZy5zZW5kKG1zZy50LnN0YXJ0X2ZsdXNoLCB7XG4gICAgICB0YWJfaWQ6IHRhYl9pZFxuICAgIH0pO1xuICB9O1xuXG4gIHBvcHVwX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICBsb2cuZCgncG9wdXAuanM6IHN0YXJ0IGluaXQgJyk7XG4gICAgcmV0dXJuIGdldF9jdXJyZW50X3RhYl9pZCgpO1xuICB9O1xuXG4gIHBvcHVwX2luaXQoKTtcblxufSkuY2FsbCh0aGlzKTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cG9wdXAuanMubWFwXG4iXX0=
